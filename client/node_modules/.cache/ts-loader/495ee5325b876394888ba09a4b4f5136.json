{"remainingRequest":"C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\ts-loader\\index.js??ref--14-3!C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\src\\js\\ChallengeProcessor.ts","dependencies":[{"path":"C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\src\\js\\ChallengeProcessor.ts","mtime":1632856214373},{"path":"C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\ts-loader\\index.js","mtime":499162500000},{"path":"C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJDOi9Vc2Vycy9naW8vRGVza3RvcC93b3JrL2xpdmVuZXNzL2xpdmVuZXNzLWRldGVjdGlvbi9jbGllbnQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJDOi9Vc2Vycy9naW8vRGVza3RvcC93b3JrL2xpdmVuZXNzL2xpdmVuZXNzLWRldGVjdGlvbi9jbGllbnQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKLy8gQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQtMAppbXBvcnQgKiBhcyBmYWNlYXBpIGZyb20gImZhY2UtYXBpLmpzIjsKaW1wb3J0IExvZ2dlciBmcm9tICJqcy1sb2dnZXIiOwppbXBvcnQgeyBEcmF3ZXIgfSBmcm9tICJAL2pzL0RyYXdlci50cyI7CmltcG9ydCB7IFJlbW90ZVZlcmlmaWVyIH0gZnJvbSAiQC9qcy9SZW1vdGVWZXJpZmllci50cyI7CmltcG9ydCB7IFN0YXRlTWFuYWdlciB9IGZyb20gIkAvanMvU3RhdGVNYW5hZ2VyLnRzIjsKaW1wb3J0IHsgVXRpbHMgfSBmcm9tICJAL2pzL1V0aWxzLnRzIjsKZXhwb3J0IHZhciBDaGFsbGVuZ2VQcm9jZXNzb3IgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIENoYWxsZW5nZVByb2Nlc3NvcihjaGFsbGVuZ2VEZXRhaWxzLCB2aWRlb0VsZW1lbnRJZCwgY2FudmFzRWxlbWVudElkLCBlbmRDYWxsYmFjaywgaGVscE1lc3NhZ2VDYWxsYmFjaywgaGVscEFuaW1hdG9uQ2FsbGJhY2spIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDaGFsbGVuZ2VQcm9jZXNzb3IpOwoKICAgIHRoaXMuZW5kQ2FsbGJhY2sgPSBlbmRDYWxsYmFjazsKICAgIHRoaXMuaGVscE1lc3NhZ2VDYWxsYmFjayA9IGhlbHBNZXNzYWdlQ2FsbGJhY2s7CiAgICB0aGlzLmhlbHBBbmltYXRvbkNhbGxiYWNrID0gaGVscEFuaW1hdG9uQ2FsbGJhY2s7CiAgICB0aGlzLnN0YXRlTWFuYWdlciA9IG5ldyBTdGF0ZU1hbmFnZXIoY2hhbGxlbmdlRGV0YWlscyk7CiAgICB0aGlzLnZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHZpZGVvRWxlbWVudElkKTsKCiAgICBpZiAoIXRoaXMudmlkZW9FbGVtZW50KSB7CiAgICAgIHRocm93ICJWaWRlbyBlbGVtZW50IG5vdCBmb3VuZCI7CiAgICB9CgogICAgdGhpcy5yZW1vdGVWZXJpZmllciA9IG5ldyBSZW1vdGVWZXJpZmllcihjaGFsbGVuZ2VEZXRhaWxzLmlkLCBjaGFsbGVuZ2VEZXRhaWxzLnRva2VuLCB0aGlzLnZpZGVvRWxlbWVudCk7CiAgICB0aGlzLmNhbnZhc0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjYW52YXNFbGVtZW50SWQpOwoKICAgIGlmICghdGhpcy5jYW52YXNFbGVtZW50KSB7CiAgICAgIHRocm93ICJDYW52YXMgZWxlbWVudCBub3QgZm91bmQiOwogICAgfQoKICAgIHRoaXMuZHJhd2VyID0gbmV3IERyYXdlcihjaGFsbGVuZ2VEZXRhaWxzLCB0aGlzLmNhbnZhc0VsZW1lbnQpOwogICAgdGhpcy52aWRlb0VsZW1lbnQuc3JjT2JqZWN0ID0gVXRpbHMuZ2V0TWVkaWFTdHJlYW1JbmZvKCkubWVkaWFTdHJlYW07CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBzZWxmLnZpZGVvRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJsb2FkZWRtZXRhZGF0YSIsIGZ1bmN0aW9uICgpIHsKICAgICAgQ2hhbGxlbmdlUHJvY2Vzc29yLnByb2Nlc3Moc2VsZik7CiAgICB9KTsKICB9CgogIF9jcmVhdGVDbGFzcyhDaGFsbGVuZ2VQcm9jZXNzb3IsIG51bGwsIFt7CiAgICBrZXk6ICJsb2FkTW9kZWxzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBsb2FkTW9kZWxzKCkgewogICAgICBpZiAoVXRpbHMuaXNQcm9maWxpbmcoKSkgewogICAgICAgIExvZ2dlci50aW1lKCJmYWNlRGV0ZWN0aW9uTW9kZWxMb2FkIik7CiAgICAgICAgTG9nZ2VyLnRpbWUoImZhY2VMYW5kbWFya01vZGVsTG9hZCIpOwogICAgICB9CgogICAgICB2YXIgcHJvbWlzZXMgPSBbXTsKICAgICAgdmFyIHVybCA9ICIvd2VpZ2h0cy8iOwogICAgICBwcm9taXNlcy5wdXNoKHRoaXMubG9hZEZhY2VEZXRlY3Rpb25Nb2RlbCh1cmwpKTsKICAgICAgcHJvbWlzZXMucHVzaCh0aGlzLmxvYWRMYW5kbWFya01vZGVsKHVybCkpOwogICAgICB3aW5kb3cubW9kZWxQcm9taXNlcyA9IHByb21pc2VzOwogICAgfQogIH0sIHsKICAgIGtleTogImxvYWRGYWNlRGV0ZWN0aW9uTW9kZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWRGYWNlRGV0ZWN0aW9uTW9kZWwodXJsKSB7CiAgICAgIHZhciBwcm9taXNlID0gZmFjZWFwaS5uZXRzLnRpbnlGYWNlRGV0ZWN0b3IubG9hZCh1cmwpOwogICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChVdGlscy5pc1Byb2ZpbGluZygpKSB7CiAgICAgICAgICBMb2dnZXIudGltZUVuZCgiZmFjZURldGVjdGlvbk1vZGVsTG9hZCIpOwogICAgICAgIH0KCiAgICAgICAgTG9nZ2VyLmluZm8oInRpbnlGYWNlRGV0ZWN0b3IgbW9kZWwgbG9hZGVkIik7CiAgICAgIH0pOwogICAgICByZXR1cm4gcHJvbWlzZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJsb2FkTGFuZG1hcmtNb2RlbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZExhbmRtYXJrTW9kZWwodXJsKSB7CiAgICAgIHZhciBwcm9taXNlID0gZmFjZWFwaS5uZXRzLmZhY2VMYW5kbWFyazY4TmV0LmxvYWQodXJsKTsKICAgICAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoVXRpbHMuaXNQcm9maWxpbmcoKSkgewogICAgICAgICAgTG9nZ2VyLnRpbWVFbmQoImZhY2VMYW5kbWFya01vZGVsTG9hZCIpOwogICAgICAgIH0KCiAgICAgICAgTG9nZ2VyLmluZm8oImZhY2VMYW5kbWFyazY4TmV0IG1vZGVsIGxvYWRlZCIpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHByb21pc2U7CiAgICB9CiAgfSwgewogICAga2V5OiAicHJvY2VzcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJvY2VzcyhjaGFsbGVuZ2VQcm9jZXNzb3IpIHsKICAgICAgTG9nZ2VyLmRlYnVnKCJ2aWRlbyBldmVudCBoYW5kbGVyIik7CgogICAgICBpZiAoY2hhbGxlbmdlUHJvY2Vzc29yLnZpZGVvRWxlbWVudC5wYXVzZWQgfHwgY2hhbGxlbmdlUHJvY2Vzc29yLnZpZGVvRWxlbWVudC5lbmRlZCkgewogICAgICAgIExvZ2dlci5kZWJ1ZygidmlkZW8gcGF1c2VkIG9yIGVuZGVkIik7CiAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIENoYWxsZW5nZVByb2Nlc3Nvci5wcm9jZXNzKGNoYWxsZW5nZVByb2Nlc3Nvcik7CiAgICAgICAgfSwgMTApOwogICAgICB9CgogICAgICBpZiAoVXRpbHMuaXNQcm9maWxpbmcoKSkgewogICAgICAgIExvZ2dlci50aW1lKCJmYWNlRGV0ZWN0aW9uV2l0aEZhY2VMYW5kbWFya3MiKTsKICAgICAgfQoKICAgICAgdmFyIG9wdGlvbnMgPSBuZXcgZmFjZWFwaS5UaW55RmFjZURldGVjdG9yT3B0aW9ucygpOwogICAgICBmYWNlYXBpLmRldGVjdEFsbEZhY2VzKGNoYWxsZW5nZVByb2Nlc3Nvci52aWRlb0VsZW1lbnQsIG9wdGlvbnMpLndpdGhGYWNlTGFuZG1hcmtzKGZhbHNlKS50aGVuKCAvLyBAdHMtaWdub3JlCiAgICAgIGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBpZiAoVXRpbHMuaXNQcm9maWxpbmcoKSkgewogICAgICAgICAgTG9nZ2VyLnRpbWVFbmQoImZhY2VEZXRlY3Rpb25XaXRoRmFjZUxhbmRtYXJrcyIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgQ2hhbGxlbmdlUHJvY2Vzc29yLnByb2Nlc3NEZXRlY3Rpb25SZXN1bHRzKGNoYWxsZW5nZVByb2Nlc3NvciwgcmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBDaGFsbGVuZ2VQcm9jZXNzb3IucHJvY2VzcyhjaGFsbGVuZ2VQcm9jZXNzb3IpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJwcm9jZXNzRGV0ZWN0aW9uUmVzdWx0cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJvY2Vzc0RldGVjdGlvblJlc3VsdHMoY2hhbGxlbmdlUHJvY2Vzc29yLCByZXN1bHRzKSB7CiAgICAgIHZhciBkaW1zID0gZmFjZWFwaS5tYXRjaERpbWVuc2lvbnMoY2hhbGxlbmdlUHJvY2Vzc29yLmNhbnZhc0VsZW1lbnQsIGNoYWxsZW5nZVByb2Nlc3Nvci52aWRlb0VsZW1lbnQpOwogICAgICB2YXIgcmVzaXplZFJlc3VsdHMgPSBmYWNlYXBpLnJlc2l6ZVJlc3VsdHMocmVzdWx0cywgZGltcyk7CiAgICAgIHZhciBzdGF0ZU1hbmFnZXJPdXRwdXQgPSBjaGFsbGVuZ2VQcm9jZXNzb3Iuc3RhdGVNYW5hZ2VyLnByb2Nlc3MocmVzdWx0cyk7CgogICAgICBpZiAoVXRpbHMuZ2V0Q29uZmlnQm9vbGVhblZhbHVlKCJEUkFXX0RFVEVDVElPTlMiKSkgewogICAgICAgIGZhY2VhcGkuZHJhdy5kcmF3RGV0ZWN0aW9ucyhjaGFsbGVuZ2VQcm9jZXNzb3IuY2FudmFzRWxlbWVudCwgcmVzaXplZFJlc3VsdHMpOwogICAgICAgIGZhY2VhcGkuZHJhdy5kcmF3RmFjZUxhbmRtYXJrcyhjaGFsbGVuZ2VQcm9jZXNzb3IuY2FudmFzRWxlbWVudCwgcmVzaXplZFJlc3VsdHMpOwogICAgICB9CgogICAgICBpZiAoc3RhdGVNYW5hZ2VyT3V0cHV0LmRyYXdPcHRpb25zKSB7CiAgICAgICAgY2hhbGxlbmdlUHJvY2Vzc29yLmRyYXdlci5kcmF3KHN0YXRlTWFuYWdlck91dHB1dC5kcmF3T3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIGlmIChzdGF0ZU1hbmFnZXJPdXRwdXQuaGVscE1lc3NhZ2UgIT09IGNoYWxsZW5nZVByb2Nlc3Nvci5sYXN0SGVscE1lc3NhZ2UpIHsKICAgICAgICBMb2dnZXIuZGVidWcoImhlbHAgbWVzc2FnZSBjaGFuZ2U6IGZyb209JyIuY29uY2F0KGNoYWxsZW5nZVByb2Nlc3Nvci5sYXN0SGVscE1lc3NhZ2UsICInIHRvPSciKS5jb25jYXQoc3RhdGVNYW5hZ2VyT3V0cHV0LmhlbHBNZXNzYWdlLCAiJyIpKTsKICAgICAgICBjaGFsbGVuZ2VQcm9jZXNzb3IuaGVscE1lc3NhZ2VDYWxsYmFjayhzdGF0ZU1hbmFnZXJPdXRwdXQuaGVscE1lc3NhZ2UpOwogICAgICB9CgogICAgICBjaGFsbGVuZ2VQcm9jZXNzb3IubGFzdEhlbHBNZXNzYWdlID0gc3RhdGVNYW5hZ2VyT3V0cHV0LmhlbHBNZXNzYWdlOwoKICAgICAgaWYgKHN0YXRlTWFuYWdlck91dHB1dC5oZWxwQW5pbWF0aW9uTnVtYmVyICE9PSBjaGFsbGVuZ2VQcm9jZXNzb3IubGFzdEhlbHBBbmltYXRpb25OdW1iZXIpIHsKICAgICAgICBMb2dnZXIuZGVidWcoImhlbHAgYW5pbWF0aW9uIGNoYW5nZTogZnJvbT0iLmNvbmNhdChjaGFsbGVuZ2VQcm9jZXNzb3IubGFzdEhlbHBBbmltYXRpb25OdW1iZXIsICIgdG89IikuY29uY2F0KHN0YXRlTWFuYWdlck91dHB1dC5oZWxwQW5pbWF0aW9uTnVtYmVyKSk7CiAgICAgICAgY2hhbGxlbmdlUHJvY2Vzc29yLmhlbHBBbmltYXRvbkNhbGxiYWNrKHN0YXRlTWFuYWdlck91dHB1dC5oZWxwQW5pbWF0aW9uTnVtYmVyKTsKICAgICAgfQoKICAgICAgY2hhbGxlbmdlUHJvY2Vzc29yLmxhc3RIZWxwQW5pbWF0aW9uTnVtYmVyID0gc3RhdGVNYW5hZ2VyT3V0cHV0LmhlbHBBbmltYXRpb25OdW1iZXI7CgogICAgICBpZiAoc3RhdGVNYW5hZ2VyT3V0cHV0LnNob3VsZFNhdmVGcmFtZSkgewogICAgICAgIExvZ2dlci5kZWJ1Zygic2hvdWxkIHNhdmUgZnJhbWUiKTsKICAgICAgICBjaGFsbGVuZ2VQcm9jZXNzb3IucmVtb3RlVmVyaWZpZXIudXBsb2FkRnJhbWUoKTsKICAgICAgfQoKICAgICAgaWYgKHN0YXRlTWFuYWdlck91dHB1dC5lbmQpIHsKICAgICAgICB2YXIgbG9jYWxTdWNjZXNzID0gc3RhdGVNYW5hZ2VyT3V0cHV0LnN1Y2Nlc3M7CgogICAgICAgIGlmIChsb2NhbFN1Y2Nlc3MpIHsKICAgICAgICAgIExvZ2dlci5pbmZvKCJjaGFsbGVuZ2Ugc3VjY2Vzc2Z1bGx5IGNvbXBsZXRlZCBsb2NhbGx5Iik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIExvZ2dlci5pbmZvKCJjaGFsbGVuZ2UgZmFpbGVkIGxvY2FsbHkiKTsKICAgICAgICB9IC8vIGlmIHN1Y2Nlc3NmdWxseSBjb21wbGV0ZWQgbG9jYWxseSwgcGFzcyBhbG9uZyByZW1vdGVWZXJpZmllciB0byBjYWxsYmFjayBmb3IgcmVtb3RlIHZlcmlmaWNhdGlvbgoKCiAgICAgICAgY2hhbGxlbmdlUHJvY2Vzc29yLmVuZENhbGxiYWNrKGxvY2FsU3VjY2VzcywgbG9jYWxTdWNjZXNzID8gY2hhbGxlbmdlUHJvY2Vzc29yLnJlbW90ZVZlcmlmaWVyIDogdW5kZWZpbmVkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZGVsYXkgPSAxMDAwIC8gcGFyc2VJbnQoVXRpbHMuZ2V0Q29uZmlnKCkuTUFYX0ZQUyk7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gQ2hhbGxlbmdlUHJvY2Vzc29yLnByb2Nlc3MoY2hhbGxlbmdlUHJvY2Vzc29yKTsKICAgICAgICB9LCBkZWxheSk7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBDaGFsbGVuZ2VQcm9jZXNzb3I7Cn0oKTs="},{"version":3,"sources":["C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\src\\js\\ChallengeProcessor.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n// SPDX-License-Identifier: MIT-0\r\n\r\nimport * as faceapi from \"face-api.js\";\r\nimport Logger from \"js-logger\";\r\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\r\nimport { Drawer } from \"@/js/Drawer.ts\";\r\nimport { RemoteVerifier } from \"@/js/RemoteVerifier.ts\";\r\nimport { StateManager } from \"@/js/StateManager.ts\";\r\nimport { StateManagerOutput } from \"@/js/StateManager.ts\";\r\nimport { Utils } from \"@/js/Utils.ts\";\r\n\r\nexport class ChallengeProcessor {\r\n  private readonly endCallback: (success: boolean, remoteVerifier: RemoteVerifier | undefined) => void;\r\n  private readonly helpMessageCallback: (helpMessage: string | undefined) => void;\r\n  private readonly helpAnimatonCallback: (helpAnimationNumber: number | undefined) => void;\r\n  private readonly drawer: Drawer;\r\n  private readonly stateManager: StateManager;\r\n  private readonly videoElement: HTMLVideoElement;\r\n  private readonly canvasElement: HTMLCanvasElement;\r\n  private readonly remoteVerifier: RemoteVerifier;\r\n\r\n  private lastHelpMessage: string | undefined;\r\n  private lastHelpAnimationNumber: number | undefined;\r\n\r\n  constructor(\r\n    challengeDetails: ChallengeDetails,\r\n    videoElementId: string,\r\n    canvasElementId: string,\r\n    endCallback: (result: boolean) => void,\r\n    helpMessageCallback: (helpMessage: string | undefined) => void,\r\n    helpAnimatonCallback: (helpAnimationNumber: number | undefined) => void\r\n  ) {\r\n    this.endCallback = endCallback;\r\n    this.helpMessageCallback = helpMessageCallback;\r\n    this.helpAnimatonCallback = helpAnimatonCallback;\r\n    this.stateManager = new StateManager(challengeDetails);\r\n    this.videoElement = document.getElementById(videoElementId) as HTMLVideoElement;\r\n    if (!this.videoElement) {\r\n      throw \"Video element not found\";\r\n    }\r\n    this.remoteVerifier = new RemoteVerifier(challengeDetails.id, challengeDetails.token, this.videoElement);\r\n\r\n    this.canvasElement = document.getElementById(canvasElementId) as HTMLCanvasElement;\r\n    if (!this.canvasElement) {\r\n      throw \"Canvas element not found\";\r\n    }\r\n    this.drawer = new Drawer(challengeDetails, this.canvasElement);\r\n\r\n    this.videoElement.srcObject = Utils.getMediaStreamInfo().mediaStream;\r\n\r\n    const self = this;\r\n    self.videoElement.addEventListener(\"loadedmetadata\", function() {\r\n      ChallengeProcessor.process(self);\r\n    });\r\n  }\r\n\r\n  static loadModels() {\r\n    if (Utils.isProfiling()) {\r\n      Logger.time(\"faceDetectionModelLoad\");\r\n      Logger.time(\"faceLandmarkModelLoad\");\r\n    }\r\n    const promises: Promise<void>[] = [];\r\n    const url = \"/weights/\";\r\n    promises.push(this.loadFaceDetectionModel(url));\r\n    promises.push(this.loadLandmarkModel(url));\r\n    (window as any).modelPromises = promises;\r\n  }\r\n\r\n  private static loadFaceDetectionModel(url: string): Promise<void> {\r\n    const promise = faceapi.nets.tinyFaceDetector.load(url);\r\n    promise.then(function() {\r\n      if (Utils.isProfiling()) {\r\n        Logger.timeEnd(\"faceDetectionModelLoad\");\r\n      }\r\n      Logger.info(\"tinyFaceDetector model loaded\");\r\n    });\r\n    return promise;\r\n  }\r\n\r\n  private static loadLandmarkModel(url: string): Promise<void> {\r\n    const promise = faceapi.nets.faceLandmark68Net.load(url);\r\n    promise.then(function() {\r\n      if (Utils.isProfiling()) {\r\n        Logger.timeEnd(\"faceLandmarkModelLoad\");\r\n      }\r\n      Logger.info(\"faceLandmark68Net model loaded\");\r\n    });\r\n    return promise;\r\n  }\r\n\r\n  static process(challengeProcessor: ChallengeProcessor): any {\r\n    Logger.debug(\"video event handler\");\r\n    if (challengeProcessor.videoElement.paused || challengeProcessor.videoElement.ended) {\r\n      Logger.debug(\"video paused or ended\");\r\n      return setTimeout(() => ChallengeProcessor.process(challengeProcessor), 10);\r\n    }\r\n\r\n    if (Utils.isProfiling()) {\r\n      Logger.time(\"faceDetectionWithFaceLandmarks\");\r\n    }\r\n    const options = new faceapi.TinyFaceDetectorOptions();\r\n    faceapi\r\n      .detectAllFaces(challengeProcessor.videoElement, options)\r\n      .withFaceLandmarks(false)\r\n      .then(\r\n        // @ts-ignore\r\n        function(result: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]) {\r\n          if (Utils.isProfiling()) {\r\n            Logger.timeEnd(\"faceDetectionWithFaceLandmarks\");\r\n          }\r\n\r\n          if (result) {\r\n            ChallengeProcessor.processDetectionResults(challengeProcessor, result);\r\n          } else {\r\n            setTimeout(() => ChallengeProcessor.process(challengeProcessor));\r\n          }\r\n        }\r\n      );\r\n  }\r\n\r\n  static processDetectionResults(\r\n    challengeProcessor: ChallengeProcessor,\r\n    results: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]\r\n  ) {\r\n    const dims = faceapi.matchDimensions(challengeProcessor.canvasElement, challengeProcessor.videoElement);\r\n    const resizedResults = faceapi.resizeResults(results, dims);\r\n    const stateManagerOutput: StateManagerOutput = challengeProcessor.stateManager.process(results);\r\n\r\n    if (Utils.getConfigBooleanValue(\"DRAW_DETECTIONS\")) {\r\n      faceapi.draw.drawDetections(challengeProcessor.canvasElement, resizedResults);\r\n      faceapi.draw.drawFaceLandmarks(challengeProcessor.canvasElement, resizedResults);\r\n    }\r\n\r\n    if (stateManagerOutput.drawOptions) {\r\n      challengeProcessor.drawer.draw(stateManagerOutput.drawOptions);\r\n    }\r\n\r\n    if (stateManagerOutput.helpMessage !== challengeProcessor.lastHelpMessage) {\r\n      Logger.debug(\r\n        `help message change: from='${challengeProcessor.lastHelpMessage}' to='${stateManagerOutput.helpMessage}'`\r\n      );\r\n      challengeProcessor.helpMessageCallback(stateManagerOutput.helpMessage);\r\n    }\r\n    challengeProcessor.lastHelpMessage = stateManagerOutput.helpMessage;\r\n\r\n    if (stateManagerOutput.helpAnimationNumber !== challengeProcessor.lastHelpAnimationNumber) {\r\n      Logger.debug(\r\n        `help animation change: from=${challengeProcessor.lastHelpAnimationNumber} to=${stateManagerOutput.helpAnimationNumber}`\r\n      );\r\n      challengeProcessor.helpAnimatonCallback(stateManagerOutput.helpAnimationNumber);\r\n    }\r\n    challengeProcessor.lastHelpAnimationNumber = stateManagerOutput.helpAnimationNumber;\r\n\r\n    if (stateManagerOutput.shouldSaveFrame) {\r\n      Logger.debug(\"should save frame\");\r\n      challengeProcessor.remoteVerifier.uploadFrame();\r\n    }\r\n\r\n    if (stateManagerOutput.end) {\r\n      const localSuccess = stateManagerOutput.success as boolean;\r\n      if (localSuccess) {\r\n        Logger.info(\"challenge successfully completed locally\");\r\n      } else {\r\n        Logger.info(\"challenge failed locally\");\r\n      }\r\n\r\n      // if successfully completed locally, pass along remoteVerifier to callback for remote verification\r\n      challengeProcessor.endCallback(localSuccess, localSuccess ? challengeProcessor.remoteVerifier : undefined);\r\n    } else {\r\n      const delay = 1000 / parseInt(Utils.getConfig().MAX_FPS);\r\n      setTimeout(() => ChallengeProcessor.process(challengeProcessor), delay);\r\n    }\r\n  }\r\n}\r\n"],"sourceRoot":""}]}