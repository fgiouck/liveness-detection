{"remainingRequest":"C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\ts-loader\\index.js??ref--14-3!C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\src\\js\\RemoteVerifier.ts","dependencies":[{"path":"C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\src\\js\\RemoteVerifier.ts","mtime":1632856214375},{"path":"C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\ts-loader\\index.js","mtime":499162500000},{"path":"C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJDOi9Vc2Vycy9naW8vRGVza3RvcC93b3JrL2xpdmVuZXNzL2xpdmVuZXNzLWRldGVjdGlvbi9jbGllbnQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJDOi9Vc2Vycy9naW8vRGVza3RvcC93b3JrL2xpdmVuZXNzL2xpdmVuZXNzLWRldGVjdGlvbi9jbGllbnQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlLmpzIjsKLy8gQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuCi8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQtMAppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgTG9nZ2VyIGZyb20gImpzLWxvZ2dlciI7CmltcG9ydCB7IFV0aWxzIH0gZnJvbSAiQC9qcy9VdGlscy50cyI7CmV4cG9ydCB2YXIgUmVtb3RlVmVyaWZpZXIgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFJlbW90ZVZlcmlmaWVyKGNoYWxsZW5nZUlkLCB0b2tlbiwgdmlkZW9FbGVtZW50KSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUmVtb3RlVmVyaWZpZXIpOwoKICAgIHRoaXMuY2hhbGxlbmdlSWQgPSBjaGFsbGVuZ2VJZDsKICAgIHRoaXMudG9rZW4gPSB0b2tlbjsKICAgIHRoaXMudmlkZW9FbGVtZW50ID0gdmlkZW9FbGVtZW50OwogICAgdGhpcy5wcm9taXNlcyA9IFtdOyAvLyBDcmVhdGUgY2FudmFzIHRvIGNvbnZlcnQgdmlkZW8gZnJhbWVzIHRvIGJsb2IKCiAgICB0aGlzLmludmlzaWJsZUNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImNhbnZhcyIpOwogICAgdGhpcy5pbnZpc2libGVDYW52YXMud2lkdGggPSB0aGlzLnZpZGVvRWxlbWVudC53aWR0aDsKICAgIHRoaXMuaW52aXNpYmxlQ2FudmFzLmhlaWdodCA9IHRoaXMudmlkZW9FbGVtZW50LmhlaWdodDsKICB9CgogIF9jcmVhdGVDbGFzcyhSZW1vdGVWZXJpZmllciwgW3sKICAgIGtleTogInVwbG9hZEZyYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGxvYWRGcmFtZSgpIHsKICAgICAgdmFyIGNvbnRleHQgPSB0aGlzLmludmlzaWJsZUNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwoKICAgICAgaWYgKGNvbnRleHQgPT09IG51bGwpIHsKICAgICAgICB0aHJvdyAiRXJyb3IgZ2V0dGluZyBjYW52YXMgY29udGV4dCI7CiAgICAgIH0KCiAgICAgIGNvbnRleHQuZHJhd0ltYWdlKHRoaXMudmlkZW9FbGVtZW50LCAwLCAwLCB0aGlzLnZpZGVvRWxlbWVudC53aWR0aCwgdGhpcy52aWRlb0VsZW1lbnQuaGVpZ2h0KTsKCiAgICAgIGlmIChVdGlscy5nZXRDb25maWdCb29sZWFuVmFsdWUoIkZMSVBfVklERU8iKSkgewogICAgICAgIGNvbnRleHQuc2NhbGUoLTEsIDEpOwogICAgICB9CgogICAgICB2YXIgY2FudmFzID0gdGhpcy5pbnZpc2libGVDYW52YXM7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdGhpcy5wcm9taXNlcy5wdXNoKG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBjYW52YXMudG9CbG9iKGZ1bmN0aW9uIChibG9iKSB7CiAgICAgICAgICBpZiAoYmxvYiA9PT0gbnVsbCkgewogICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCJFcnJvciBjcmVhdGluZyBibG9iIGZyb20gY2FudmFzIikpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgUmVtb3RlVmVyaWZpZXIuY2FsbEZyYW1lc0FwaShzZWxmLmNoYWxsZW5nZUlkLCBzZWxmLnRva2VuLCBibG9iLCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgfQogICAgICAgIH0sICJpbWFnZS9qcGVnIiwgcGFyc2VGbG9hdChVdGlscy5nZXRDb25maWcoKS5JTUFHRV9KUEdfUVVBTElUWSkpOwogICAgICB9KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAidmVyaWZ5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiB2ZXJpZnkoc3VjY2Vzc0NhbGxiYWNrLCBlcnJvckNhbGxiYWNrKSB7CiAgICAgIExvZ2dlci5kZWJ1Zyh0aGlzLnByb21pc2VzKTsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBQcm9taXNlLmFsbCh0aGlzLnByb21pc2VzKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBMb2dnZXIuaW5mbygiYWxsIGZyYW1lcyB1cGxvYWRlZCIpOwogICAgICAgIHZhciByZXF1ZXN0RGF0YSA9IHsKICAgICAgICAgIHRva2VuOiBzZWxmLnRva2VuCiAgICAgICAgfTsKICAgICAgICBzZWxmLmNhbGxWZXJpZmljYXRpb25BcGkocmVxdWVzdERhdGEsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjayk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImNhbGxWZXJpZmljYXRpb25BcGkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNhbGxWZXJpZmljYXRpb25BcGkocmVxdWVzdERhdGEsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgewogICAgICB2YXIgdmVyaWZ5RW5kcG9pbnQgPSBVdGlscy5nZXRDb25maWcoKS5BUElfVkVSSUZZX0VORFBPSU5UX1BBVFRFUk4ucmVwbGFjZSgie2NoYWxsZW5nZUlkfSIsIHRoaXMuY2hhbGxlbmdlSWQpOwogICAgICB2YXIgdXJsID0gVXRpbHMuZ2V0Q29uZmlnKCkuQVBJX1VSTCArIHZlcmlmeUVuZHBvaW50OwogICAgICBMb2dnZXIuaW5mbygiY2FsbGluZyAiLmNvbmNhdCh1cmwpKTsKICAgICAgTG9nZ2VyLmluZm8ocmVxdWVzdERhdGEpOwogICAgICB2YXIgcHJvbWlzZSA9IGF4aW9zLnBvc3QodXJsLCByZXF1ZXN0RGF0YSk7CiAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBMb2dnZXIuaW5mbyhyZXNwb25zZSk7CiAgICAgICAgdmFyIHZlcmlmeVJlc3BvbnNlRGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgTG9nZ2VyLmluZm8odmVyaWZ5UmVzcG9uc2VEYXRhKTsKICAgICAgICBzdWNjZXNzQ2FsbGJhY2sodmVyaWZ5UmVzcG9uc2VEYXRhLnN1Y2Nlc3MpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICBMb2dnZXIuZXJyb3IoZXJyb3IpOwogICAgICAgIGVycm9yQ2FsbGJhY2soZXJyb3IpOwogICAgICB9KTsKICAgIH0KICB9XSwgW3sKICAgIGtleTogImNhbGxGcmFtZXNBcGkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNhbGxGcmFtZXNBcGkoY2hhbGxlbmdlSWQsIHRva2VuLCBibG9iLCByZXNvbHZlLCByZWplY3QpIHsKICAgICAgTG9nZ2VyLmluZm8oInVwbG9hZGluZyBmcmFtZSIpOwogICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoYmxvYik7CgogICAgICByZWFkZXIub25sb2FkZW5kID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBmcmFtZXNFbmRwb2ludCA9IFV0aWxzLmdldENvbmZpZygpLkFQSV9GUkFNRVNfRU5EUE9JTlRfUEFUVEVSTi5yZXBsYWNlKCJ7Y2hhbGxlbmdlSWR9IiwgY2hhbGxlbmdlSWQpOwogICAgICAgIHZhciB1cmwgPSBVdGlscy5nZXRDb25maWcoKS5BUElfVVJMICsgZnJhbWVzRW5kcG9pbnQ7CiAgICAgICAgTG9nZ2VyLmluZm8oImNhbGxpbmcgIi5jb25jYXQodXJsKSk7CiAgICAgICAgdmFyIGRhdGFVcmwgPSByZWFkZXIucmVzdWx0OwogICAgICAgIHZhciByZXF1ZXN0RGF0YSA9IHsKICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSwKICAgICAgICAgIGZyYW1lQmFzZTY0OiBkYXRhVXJsLnN1YnN0cihkYXRhVXJsLmluZGV4T2YoIiwiKSArIDEpLAogICAgICAgICAgdG9rZW46IHRva2VuCiAgICAgICAgfTsKICAgICAgICBMb2dnZXIuaW5mbyhyZXF1ZXN0RGF0YSk7CiAgICAgICAgdmFyIHByb21pc2UgPSBheGlvcy5wdXQodXJsLCByZXF1ZXN0RGF0YSk7CiAgICAgICAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgTG9nZ2VyLmluZm8ocmVzcG9uc2UpOwogICAgICAgICAgdmFyIHZlcmlmeVJlc3BvbnNlRGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICBMb2dnZXIuaW5mbyh2ZXJpZnlSZXNwb25zZURhdGEpOwogICAgICAgICAgTG9nZ2VyLmluZm8oImZyYW1lIHN1Y2Nlc3NmdWxseSB1cGxvYWRlZCIpOwogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgTG9nZ2VyLmVycm9yKGVycm9yKTsKICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgfSk7CiAgICAgIH07CiAgICB9CiAgfV0pOwoKICByZXR1cm4gUmVtb3RlVmVyaWZpZXI7Cn0oKTs="},{"version":3,"sources":["C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\gio\\Desktop\\work\\liveness\\liveness-detection\\client\\src\\js\\RemoteVerifier.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n// SPDX-License-Identifier: MIT-0\r\n\r\nimport axios from \"axios\";\r\nimport Logger from \"js-logger\";\r\nimport { Utils } from \"@/js/Utils.ts\";\r\n\r\ninterface FramesRequestData {\r\n  readonly timestamp: number;\r\n  readonly frameBase64: string;\r\n  readonly token: string;\r\n}\r\n\r\ninterface FramesResponseData {\r\n  readonly message: string;\r\n}\r\n\r\ninterface VerifyRequestData {\r\n  readonly token: string;\r\n}\r\n\r\ninterface VerifyResponseData {\r\n  readonly success: boolean;\r\n}\r\n\r\nexport class RemoteVerifier {\r\n  private readonly challengeId: string;\r\n  private readonly token: string;\r\n  private readonly videoElement: HTMLVideoElement;\r\n  private readonly promises: Promise<any>[];\r\n  private readonly invisibleCanvas: HTMLCanvasElement;\r\n\r\n  constructor(challengeId: string, token: string, videoElement: HTMLVideoElement) {\r\n    this.challengeId = challengeId;\r\n    this.token = token;\r\n    this.videoElement = videoElement;\r\n    this.promises = [];\r\n\r\n    // Create canvas to convert video frames to blob\r\n    this.invisibleCanvas = document.createElement(\"canvas\");\r\n    this.invisibleCanvas.width = this.videoElement.width;\r\n    this.invisibleCanvas.height = this.videoElement.height;\r\n  }\r\n\r\n  uploadFrame() {\r\n    const context = this.invisibleCanvas.getContext(\"2d\");\r\n    if (context === null) {\r\n      throw \"Error getting canvas context\";\r\n    }\r\n    context.drawImage(this.videoElement, 0, 0, this.videoElement.width, this.videoElement.height);\r\n\r\n    if (Utils.getConfigBooleanValue(\"FLIP_VIDEO\")) {\r\n      context.scale(-1, 1);\r\n    }\r\n\r\n    const canvas = this.invisibleCanvas;\r\n    const self = this;\r\n    this.promises.push(\r\n      new Promise(function(resolve: () => void, reject: (error: Error) => void) {\r\n        canvas.toBlob(\r\n          function(blob) {\r\n            if (blob === null) {\r\n              reject(new Error(\"Error creating blob from canvas\"));\r\n            } else {\r\n              RemoteVerifier.callFramesApi(self.challengeId, self.token, blob, resolve, reject);\r\n            }\r\n          },\r\n          \"image/jpeg\",\r\n          parseFloat(Utils.getConfig().IMAGE_JPG_QUALITY)\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  static callFramesApi(\r\n    challengeId: string,\r\n    token: string,\r\n    blob: Blob,\r\n    resolve: () => void,\r\n    reject: (error: Error) => void\r\n  ) {\r\n    Logger.info(\"uploading frame\");\r\n    const reader: FileReader = new FileReader();\r\n    reader.readAsDataURL(blob);\r\n    reader.onloadend = function() {\r\n      const framesEndpoint: string = Utils.getConfig().API_FRAMES_ENDPOINT_PATTERN.replace(\r\n        \"{challengeId}\",\r\n        challengeId\r\n      );\r\n      const url: string = Utils.getConfig().API_URL + framesEndpoint;\r\n\r\n      Logger.info(`calling ${url}`);\r\n      const dataUrl = reader.result as string;\r\n      const requestData: FramesRequestData = {\r\n        timestamp: Date.now(),\r\n        frameBase64: dataUrl.substr(dataUrl.indexOf(\",\") + 1),\r\n        token: token\r\n      };\r\n      Logger.info(requestData);\r\n      const promise = axios.put(url, requestData);\r\n      promise\r\n        .then(function(response: any) {\r\n          Logger.info(response);\r\n          const verifyResponseData: FramesResponseData = response.data;\r\n          Logger.info(verifyResponseData);\r\n          Logger.info(\"frame successfully uploaded\");\r\n          resolve();\r\n        })\r\n        .catch(function(error: any) {\r\n          Logger.error(error);\r\n          reject(error);\r\n        });\r\n    };\r\n  }\r\n\r\n  verify(successCallback: (result: boolean) => void, errorCallback: (error: Error) => void): void {\r\n    Logger.debug(this.promises);\r\n    const self = this;\r\n    Promise.all(this.promises).then(function() {\r\n      Logger.info(\"all frames uploaded\");\r\n      const requestData: VerifyRequestData = {\r\n        token: self.token\r\n      };\r\n      self.callVerificationApi(requestData, successCallback, errorCallback);\r\n    });\r\n  }\r\n\r\n  private callVerificationApi(\r\n    requestData: VerifyRequestData,\r\n    successCallback: (result: boolean) => void,\r\n    errorCallback: (error: Error) => void\r\n  ): void {\r\n    const verifyEndpoint: string = Utils.getConfig().API_VERIFY_ENDPOINT_PATTERN.replace(\r\n      \"{challengeId}\",\r\n      this.challengeId\r\n    );\r\n    const url: string = Utils.getConfig().API_URL + verifyEndpoint;\r\n\r\n    Logger.info(`calling ${url}`);\r\n    Logger.info(requestData);\r\n    const promise = axios.post(url, requestData);\r\n    promise\r\n      .then(function(response: any) {\r\n        Logger.info(response);\r\n        const verifyResponseData: VerifyResponseData = response.data;\r\n        Logger.info(verifyResponseData);\r\n        successCallback(verifyResponseData.success);\r\n      })\r\n      .catch(function(error: any) {\r\n        Logger.error(error);\r\n        errorCallback(error);\r\n      });\r\n  }\r\n}\r\n"],"sourceRoot":""}]}