{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?7e02","webpack:///./src/components/Challenge.vue?4861","webpack:///./src/components/Spinner.vue?09a4","webpack:///./src/App.vue?97f2","webpack:///./src/components/Challenge.vue?8c16","webpack:///./src/js/Drawer.ts","webpack:///./src/js/Utils.ts","webpack:///./src/js/RemoteVerifier.ts","webpack:///./src/js/States.ts","webpack:///./src/js/StateManager.ts","webpack:///./src/js/ChallengeProcessor.ts","webpack:///./src/components/Challenge.vue","webpack:///./src/components/Challenge.vue?5486","webpack:///./src/components/Challenge.vue?0c2b","webpack:///./src/components/Spinner.vue?9f9d","webpack:///./src/components/Spinner.vue","webpack:///./src/components/Spinner.vue?703c","webpack:///./src/components/Spinner.vue?cbee","webpack:///./src/components/Welcome.vue?6913","webpack:///./src/js/RemoteStarter.ts","webpack:///./src/components/Welcome.vue","webpack:///./src/components/Welcome.vue?8d51","webpack:///./src/components/Welcome.vue?6fac","webpack:///./src/components/Result.vue?99ac","webpack:///./src/components/Result.vue","webpack:///./src/components/Result.vue?638f","webpack:///./src/components/Result.vue?dcf5","webpack:///./src/components/Error.vue?174e","webpack:///./src/components/Error.vue","webpack:///./src/components/Error.vue?78db","webpack:///./src/components/Error.vue?0f86","webpack:///./src/App.vue?ec60","webpack:///./src/App.vue?0ab4","webpack:///./src/App.vue?bff9","webpack:///./src/main.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","_vm","this","_h","$createElement","_c","_self","attrs","step","mediaStreamReady","on","$event","onChallengeDetails","onError","challengeDetails","onLocalSuccess","onLocalFail","success","onRestart","errorMessage","_e","staticRenderFns","staticClass","style","class","rotate","shouldRotate","videoWidth","videoHeight","domProps","_v","_s","message","directives","rawName","animation","expression","lottieOptions1","lottieOptions2","canvasElement","drawOptions","faceDrawBoxOptions","faceAreaBox","x","areaLeft","y","areaTop","width","areaWidth","height","areaHeight","drawArea","noseDrawBoxOptions","noseAreaBox","noseLeft","noseTop","noseWidth","noseHeight","box","drawBoxOptions","drawBox","DrawBox","draw","COLOR_RED","COLOR_GREEN","COLOR_YELLOW","envKeys","keys","map","Map","forEach","envKey","replace","Utils","KEY_PREFIX","set","config","fromEntries","configKey","getConfig","trim","toLowerCase","getConfigBooleanValue","useDefaults","setLevel","OFF","Logger","successCallback","errorCallback","constraints","audio","video","parseInt","IMAGE_WIDTH","IMAGE_HEIGHT","facingMode","navigator","mediaDevices","getUserMedia","then","mediaStream","mediaStreamInfo","actualHeight","getVideoTracks","getSettings","actualWidth","info","error","catch","userId","localStorage","getItem","setItem","challengeId","token","videoElement","promises","invisibleCanvas","document","createElement","context","getContext","drawImage","scale","canvas","self","Promise","resolve","reject","toBlob","blob","Error","RemoteVerifier","callFramesApi","parseFloat","IMAGE_JPG_QUALITY","debug","all","requestData","callVerificationApi","verifyEndpoint","API_VERIFY_ENDPOINT_PATTERN","url","API_URL","promise","a","post","response","verifyResponseData","reader","FileReader","readAsDataURL","onloadend","framesEndpoint","API_FRAMES_ENDPOINT_PATTERN","dataUrl","timestamp","Date","now","frameBase64","substr","indexOf","put","_faces","faceBox","addTolerance","tolerance","FACE_AREA_TOLERANCE_PERCENT","nose","FailState","NAME","SuccessState","framesWithoutFace","landmarkIndex","LANDMARK_INDEX","faces","nextState","isFaceBoxInsideFaceArea","detection","isNoseInsideNoseArea","landmarks","positions","STATE_NOSE_MAX_FRAMES_WITHOUT_FACE","boxColor","helpMessage","helpAnimationNumber","STATE_NOSE_DURATION_IN_SECONDS","NoseState","STATE_AREA_MAX_FRAMES_WITHOUT_FACE","STATE_AREA_DURATION_IN_SECONDS","AreaState","undefined","FaceState","changeCurrentState","currentState","getName","endTime","stateOutput","process","end","shouldSaveFrame","state","getMaximumDurationInSeconds","videoElementId","canvasElementId","endCallback","helpMessageCallback","helpAnimatonCallback","stateManager","getElementById","remoteVerifier","id","drawer","srcObject","getMediaStreamInfo","addEventListener","ChallengeProcessor","isProfiling","time","loadFaceDetectionModel","loadLandmarkModel","modelPromises","tinyFaceDetector","load","timeEnd","faceLandmark68Net","challengeProcessor","paused","ended","setTimeout","options","withFaceLandmarks","processDetectionResults","results","dims","resizedResults","stateManagerOutput","drawDetections","drawFaceLandmarks","lastHelpMessage","lastHelpAnimationNumber","uploadFrame","localSuccess","delay","MAX_FPS","extend","components","Lottie","props","details","animationData","help1","help2","cssVars","methods","onLocalEnd","$emit","onHelpMessage","onHelpAnimation","animationNumber","mounted","$nextTick","component","_m","ref","cpf","target","composing","persist","lottieOptions","ready","start","API_START_ENDPOINT","startRequestData","getUserId","imageWidth","imageHeight","Boolean","welcome","loop","loading","cpfliveness","startChallenge","title","buttonText","SUCCESS_TITLE","SUCCESS_MESSAGE","SUCCESS_BUTTON","FAIL_TITLE","FAIL_MESSAGE","FAIL_BUTTON","computed","fail","String","loadConfig","configureLogger","Welcome","Challenge","Spinner","Result","verify","loadModels","loadMediaStream","productionTip","render","h","App","$mount"],"mappings":"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","file":"js/app.6acefa13.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Challenge.vue?vue&type=style&index=0&id=3d4ee5b2&scoped=true&lang=css&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Spinner.vue?vue&type=style&index=0&id=4cdecada&scoped=true&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[(_vm.step === 1)?_c('Welcome',{attrs:{\"ready\":_vm.mediaStreamReady},on:{\"challenge-details\":function($event){return _vm.onChallengeDetails($event)},\"error\":function($event){return _vm.onError($event)}}}):(_vm.step === 2)?_c('Challenge',{attrs:{\"details\":_vm.challengeDetails},on:{\"local-success\":function($event){return _vm.onLocalSuccess($event)},\"local-fail\":function($event){return _vm.onLocalFail()},\"error\":function($event){return _vm.onError($event)}}}):(_vm.step === 3)?_c('Spinner'):(_vm.step === 4)?_c('Result',{attrs:{\"success\":_vm.success},on:{\"restart\":function($event){return _vm.onRestart()}}}):(_vm.step === -1)?_c('Error',{attrs:{\"message\":_vm.errorMessage},on:{\"restart\":function($event){return _vm.onRestart()}}}):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"videoContainer mx-auto\",style:(_vm.cssVars)},[_c('video',{class:{ rotate: _vm.shouldRotate },attrs:{\"id\":\"webcamVideo\",\"width\":_vm.videoWidth,\"height\":_vm.videoHeight,\"autoplay\":\"\",\"muted\":\"\",\"playsinline\":\"\"},domProps:{\"muted\":true}}),_c('canvas',{class:{ rotate: _vm.shouldRotate },attrs:{\"id\":\"overlayCanvas\",\"width\":_vm.videoWidth,\"height\":_vm.videoHeight}}),_c('div',{staticClass:\"helpContainer clearfix\"},[_c('div',{staticClass:\"float-left messageContainer\"},[_c('div',{staticClass:\"message\"},[_c('h5',[_vm._v(_vm._s(_vm.message))])])]),_c('div',{staticClass:\"float-right\"},[_c('lottie',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.animation === 1),expression:\"animation === 1\"}],attrs:{\"options\":_vm.lottieOptions1,\"height\":100,\"width\":100}}),_c('lottie',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.animation === 2),expression:\"animation === 2\"}],attrs:{\"options\":_vm.lottieOptions2,\"height\":100,\"width\":100}})],1)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n// SPDX-License-Identifier: MIT-0\r\n\r\nimport * as faceapi from \"face-api.js\";\r\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\r\n\r\nexport interface DrawBoxOptions {\r\n  readonly boxColor?: string;\r\n  readonly lineWidth?: number;\r\n}\r\n\r\nexport interface DrawOptions {\r\n  readonly faceDrawBoxOptions?: DrawBoxOptions;\r\n  readonly noseDrawBoxOptions?: DrawBoxOptions;\r\n}\r\n\r\nexport class Drawer {\r\n  public static COLOR_RED = \"rgba(255, 0, 0, 1)\";\r\n  public static COLOR_GREEN = \"rgba(0, 255, 0, 1)\";\r\n  public static COLOR_YELLOW = \"rgba(255, 255, 0, 1)\";\r\n\r\n  private readonly challengeDetails: ChallengeDetails;\r\n  private readonly canvasElement: HTMLCanvasElement;\r\n\r\n  constructor(challengeDetails: ChallengeDetails, canvasElement: HTMLCanvasElement) {\r\n    this.challengeDetails = challengeDetails;\r\n    this.canvasElement = canvasElement;\r\n  }\r\n\r\n  draw(drawOptions: DrawOptions) {\r\n    if (drawOptions.faceDrawBoxOptions) {\r\n      const faceAreaBox = {\r\n        x: this.challengeDetails.areaLeft,\r\n        y: this.challengeDetails.areaTop,\r\n        width: this.challengeDetails.areaWidth,\r\n        height: this.challengeDetails.areaHeight\r\n      };\r\n      this.drawArea(faceAreaBox, drawOptions.faceDrawBoxOptions);\r\n    }\r\n    if (drawOptions.noseDrawBoxOptions) {\r\n      const noseAreaBox = {\r\n        x: this.challengeDetails.noseLeft,\r\n        y: this.challengeDetails.noseTop,\r\n        width: this.challengeDetails.noseWidth,\r\n        height: this.challengeDetails.noseHeight\r\n      };\r\n      this.drawArea(noseAreaBox, drawOptions.noseDrawBoxOptions);\r\n    }\r\n  }\r\n\r\n  private drawArea(box: faceapi.IRect, drawBoxOptions: DrawBoxOptions) {\r\n    const drawBox = new faceapi.draw.DrawBox(box, drawBoxOptions);\r\n    drawBox.draw(this.canvasElement);\r\n  }\r\n}\r\n","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n// SPDX-License-Identifier: MIT-0\r\n\r\nimport Logger from \"js-logger\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\n\r\nexport interface Config {\r\n  DRAW_DETECTIONS: string;\r\n  PROFILING: string;\r\n  API_URL: string;\r\n  API_START_ENDPOINT: string;\r\n  API_VERIFY_ENDPOINT_PATTERN: string;\r\n  API_FRAMES_ENDPOINT_PATTERN: string;\r\n  IMAGE_WIDTH: string;\r\n  IMAGE_HEIGHT: string;\r\n  IMAGE_JPG_QUALITY: string;\r\n  STATE_AREA_DURATION_IN_SECONDS: string;\r\n  STATE_NOSE_DURATION_IN_SECONDS: string;\r\n  STATE_AREA_MAX_FRAMES_WITHOUT_FACE: string;\r\n  STATE_NOSE_MAX_FRAMES_WITHOUT_FACE: string;\r\n  MAX_FPS: string;\r\n  FACE_AREA_TOLERANCE_PERCENT: string;\r\n  FLIP_VIDEO: string;\r\n  LANDMARK_INDEX: string;\r\n}\r\n\r\nexport interface MediaStreamInfo {\r\n  mediaStream: MediaStream;\r\n  actualHeight: number;\r\n  actualWidth: number;\r\n}\r\n\r\nexport class Utils {\r\n  private static KEY_PREFIX = \"VUE_APP_\";\r\n\r\n  static loadConfig() {\r\n    const envKeys = Object.keys(process.env);\r\n    const map = new Map();\r\n    envKeys.forEach(function(envKey) {\r\n      const key = envKey.replace(Utils.KEY_PREFIX, \"\");\r\n      const value = process.env[envKey] as string;\r\n      map.set(key, value);\r\n    });\r\n    (window as any).config = Object.fromEntries(map);\r\n  }\r\n\r\n  static getConfig(): Config {\r\n    return (window as any).config as Config;\r\n  }\r\n\r\n  static getConfigBooleanValue(configKey: string): boolean {\r\n    return (\r\n      // @ts-ignore\r\n      Utils.getConfig()\r\n        [configKey].trim()\r\n        .toLowerCase() === \"true\"\r\n    );\r\n  }\r\n\r\n  static isProfiling(): boolean {\r\n    return Utils.getConfigBooleanValue(\"PROFILING\");\r\n  }\r\n\r\n  static configureLogger() {\r\n    Logger.useDefaults();\r\n    if (process.env.NODE_ENV == \"production\") {\r\n      Logger.setLevel(Logger.OFF);\r\n    }\r\n    (window as any).Logger = Logger;\r\n  }\r\n\r\n  static loadMediaStream(successCallback: () => void, errorCallback: (message: string) => void) {\r\n    const constraints: MediaStreamConstraints = {\r\n      audio: false,\r\n      video: {\r\n        width: parseInt(Utils.getConfig().IMAGE_WIDTH),\r\n        height: parseInt(Utils.getConfig().IMAGE_HEIGHT),\r\n        facingMode: \"user\"\r\n      }\r\n    };\r\n    navigator.mediaDevices\r\n      .getUserMedia(constraints)\r\n      .then(function(mediaStream: MediaStream) {\r\n        try {\r\n          const mediaStreamInfo = {\r\n            mediaStream: mediaStream,\r\n            actualHeight: mediaStream.getVideoTracks()[0].getSettings().height,\r\n            actualWidth: mediaStream.getVideoTracks()[0].getSettings().width\r\n          };\r\n          Logger.info(\r\n            `media info: actualHeight=${mediaStreamInfo.actualHeight} actualWidth=${mediaStreamInfo.actualWidth}`\r\n          );\r\n          (window as any).mediaStreamInfo = mediaStreamInfo;\r\n        } catch (error) {\r\n          Logger.error(error);\r\n          errorCallback(\"Error getting video actual sizes\");\r\n        }\r\n        successCallback();\r\n      })\r\n      .catch(function(error) {\r\n        Logger.error(error);\r\n        errorCallback(\"Error getting access to the camera\");\r\n      });\r\n  }\r\n\r\n  static getMediaStreamInfo(): MediaStreamInfo {\r\n    return (window as any).mediaStreamInfo as MediaStreamInfo;\r\n  }\r\n\r\n  static getUserId(): string {\r\n    let userId = window.localStorage.getItem(\"userId\");\r\n    if (userId === null) {\r\n      userId = uuidv4();\r\n      window.localStorage.setItem(\"userId\", userId);\r\n    }\r\n    Logger.info(`userId=${userId}`);\r\n    return userId;\r\n  }\r\n}\r\n","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n// SPDX-License-Identifier: MIT-0\r\n\r\nimport axios from \"axios\";\r\nimport Logger from \"js-logger\";\r\nimport { Utils } from \"@/js/Utils.ts\";\r\n\r\ninterface FramesRequestData {\r\n  readonly timestamp: number;\r\n  readonly frameBase64: string;\r\n  readonly token: string;\r\n}\r\n\r\ninterface FramesResponseData {\r\n  readonly message: string;\r\n}\r\n\r\ninterface VerifyRequestData {\r\n  readonly token: string;\r\n}\r\n\r\ninterface VerifyResponseData {\r\n  readonly success: boolean;\r\n}\r\n\r\nexport class RemoteVerifier {\r\n  private readonly challengeId: string;\r\n  private readonly token: string;\r\n  private readonly videoElement: HTMLVideoElement;\r\n  private readonly promises: Promise<any>[];\r\n  private readonly invisibleCanvas: HTMLCanvasElement;\r\n\r\n  constructor(challengeId: string, token: string, videoElement: HTMLVideoElement) {\r\n    this.challengeId = challengeId;\r\n    this.token = token;\r\n    this.videoElement = videoElement;\r\n    this.promises = [];\r\n\r\n    // Create canvas to convert video frames to blob\r\n    this.invisibleCanvas = document.createElement(\"canvas\");\r\n    this.invisibleCanvas.width = this.videoElement.width;\r\n    this.invisibleCanvas.height = this.videoElement.height;\r\n  }\r\n\r\n  uploadFrame() {\r\n    const context = this.invisibleCanvas.getContext(\"2d\");\r\n    if (context === null) {\r\n      throw \"Error getting canvas context\";\r\n    }\r\n    context.drawImage(this.videoElement, 0, 0, this.videoElement.width, this.videoElement.height);\r\n\r\n    if (Utils.getConfigBooleanValue(\"FLIP_VIDEO\")) {\r\n      context.scale(-1, 1);\r\n    }\r\n\r\n    const canvas = this.invisibleCanvas;\r\n    const self = this;\r\n    this.promises.push(\r\n      new Promise(function(resolve: () => void, reject: (error: Error) => void) {\r\n        canvas.toBlob(\r\n          function(blob) {\r\n            if (blob === null) {\r\n              reject(new Error(\"Error creating blob from canvas\"));\r\n            } else {\r\n              RemoteVerifier.callFramesApi(self.challengeId, self.token, blob, resolve, reject);\r\n            }\r\n          },\r\n          \"image/jpeg\",\r\n          parseFloat(Utils.getConfig().IMAGE_JPG_QUALITY)\r\n        );\r\n      })\r\n    );\r\n  }\r\n\r\n  static callFramesApi(\r\n    challengeId: string,\r\n    token: string,\r\n    blob: Blob,\r\n    resolve: () => void,\r\n    reject: (error: Error) => void\r\n  ) {\r\n    Logger.info(\"uploading frame\");\r\n    const reader: FileReader = new FileReader();\r\n    reader.readAsDataURL(blob);\r\n    reader.onloadend = function() {\r\n      const framesEndpoint: string = Utils.getConfig().API_FRAMES_ENDPOINT_PATTERN.replace(\r\n        \"{challengeId}\",\r\n        challengeId\r\n      );\r\n      const url: string = Utils.getConfig().API_URL + framesEndpoint;\r\n\r\n      Logger.info(`calling ${url}`);\r\n      const dataUrl = reader.result as string;\r\n      const requestData: FramesRequestData = {\r\n        timestamp: Date.now(),\r\n        frameBase64: dataUrl.substr(dataUrl.indexOf(\",\") + 1),\r\n        token: token\r\n      };\r\n      Logger.info(requestData);\r\n      const promise = axios.put(url, requestData);\r\n      promise\r\n        .then(function(response: any) {\r\n          Logger.info(response);\r\n          const verifyResponseData: FramesResponseData = response.data;\r\n          Logger.info(verifyResponseData);\r\n          Logger.info(\"frame successfully uploaded\");\r\n          resolve();\r\n        })\r\n        .catch(function(error: any) {\r\n          Logger.error(error);\r\n          reject(error);\r\n        });\r\n    };\r\n  }\r\n\r\n  verify(successCallback: (result: boolean) => void, errorCallback: (error: Error) => void): void {\r\n    Logger.debug(this.promises);\r\n    const self = this;\r\n    Promise.all(this.promises).then(function() {\r\n      Logger.info(\"all frames uploaded\");\r\n      const requestData: VerifyRequestData = {\r\n        token: self.token\r\n      };\r\n      self.callVerificationApi(requestData, successCallback, errorCallback);\r\n    });\r\n  }\r\n\r\n  private callVerificationApi(\r\n    requestData: VerifyRequestData,\r\n    successCallback: (result: boolean) => void,\r\n    errorCallback: (error: Error) => void\r\n  ): void {\r\n    const verifyEndpoint: string = Utils.getConfig().API_VERIFY_ENDPOINT_PATTERN.replace(\r\n      \"{challengeId}\",\r\n      this.challengeId\r\n    );\r\n    const url: string = Utils.getConfig().API_URL + verifyEndpoint;\r\n\r\n    Logger.info(`calling ${url}`);\r\n    Logger.info(requestData);\r\n    const promise = axios.post(url, requestData);\r\n    promise\r\n      .then(function(response: any) {\r\n        Logger.info(response);\r\n        const verifyResponseData: VerifyResponseData = response.data;\r\n        Logger.info(verifyResponseData);\r\n        successCallback(verifyResponseData.success);\r\n      })\r\n      .catch(function(error: any) {\r\n        Logger.error(error);\r\n        errorCallback(error);\r\n      });\r\n  }\r\n}\r\n","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n// SPDX-License-Identifier: MIT-0\r\n\r\nimport * as faceapi from \"face-api.js\";\r\nimport Logger from \"js-logger\";\r\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\r\nimport { Drawer, DrawOptions } from \"@/js/Drawer.ts\";\r\nimport { Utils } from \"@/js/Utils.ts\";\r\n\r\nexport interface StateOutput {\r\n  readonly nextState?: State;\r\n  readonly drawOptions?: DrawOptions;\r\n  readonly helpMessage?: string;\r\n  readonly helpAnimationNumber?: number;\r\n}\r\n\r\nexport abstract class State {\r\n  constructor(readonly challengeDetails: ChallengeDetails) {}\r\n\r\n  process(\r\n    // eslint-disable-next-line\r\n    _faces: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]\r\n  ): StateOutput {\r\n    return {};\r\n  }\r\n\r\n  getMaximumDurationInSeconds(): number {\r\n    return -1;\r\n  }\r\n\r\n  protected isFaceBoxInsideFaceArea(faceBox: faceapi.Box, addTolerance = true) {\r\n    const tolerance: number = addTolerance ? parseInt(Utils.getConfig().FACE_AREA_TOLERANCE_PERCENT) / 100 : 0;\r\n    return (\r\n      faceBox.x >= this.challengeDetails.areaLeft * (1 - tolerance) &&\r\n      faceBox.y >= this.challengeDetails.areaTop * (1 - tolerance) &&\r\n      faceBox.x + faceBox.width <= this.challengeDetails.areaLeft + this.challengeDetails.areaWidth * (1 + tolerance) &&\r\n      faceBox.y + faceBox.height <= this.challengeDetails.areaTop + this.challengeDetails.areaHeight * (1 + tolerance)\r\n    );\r\n  }\r\n\r\n  protected isNoseInsideNoseArea(nose: faceapi.IPoint) {\r\n    return (\r\n      nose.x >= this.challengeDetails.noseLeft &&\r\n      nose.y >= this.challengeDetails.noseTop &&\r\n      nose.x <= this.challengeDetails.noseLeft + this.challengeDetails.noseWidth &&\r\n      nose.y <= this.challengeDetails.noseTop + this.challengeDetails.noseHeight\r\n    );\r\n  }\r\n\r\n  abstract getName(): string;\r\n}\r\n\r\nexport class FailState extends State {\r\n  static NAME = \"FailState\";\r\n\r\n  getName(): string {\r\n    return FailState.NAME;\r\n  }\r\n}\r\n\r\nexport class SuccessState extends State {\r\n  static NAME = \"SuccessState\";\r\n\r\n  getName(): string {\r\n    return SuccessState.NAME;\r\n  }\r\n}\r\n\r\nexport class NoseState extends State {\r\n  static NAME = \"NoseState\";\r\n\r\n  private framesWithoutFace = 0;\r\n  private landmarkIndex = parseInt(Utils.getConfig().LANDMARK_INDEX);\r\n\r\n  process(\r\n    faces: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]\r\n  ): StateOutput {\r\n    let nextState: State = this;\r\n    if (faces.length === 1) {\r\n      if (this.isFaceBoxInsideFaceArea(faces[0].detection.box)) {\r\n        if (this.isNoseInsideNoseArea(faces[0].landmarks.positions[this.landmarkIndex])) {\r\n          nextState = new SuccessState(this.challengeDetails);\r\n        }\r\n      } else {\r\n        Logger.info(`NoseState fail: isFaceBoxInsideFaceArea=${this.isFaceBoxInsideFaceArea(faces[0].detection.box)}`);\r\n        nextState = new FailState(this.challengeDetails);\r\n      }\r\n    } else {\r\n      if (\r\n        faces.length !== 0 ||\r\n        ++this.framesWithoutFace > parseInt(Utils.getConfig().STATE_NOSE_MAX_FRAMES_WITHOUT_FACE)\r\n      ) {\r\n        Logger.info(`NoseState fail: #faces=${faces.length} framesWithoutFace=${this.framesWithoutFace}`);\r\n        nextState = new FailState(this.challengeDetails);\r\n      } else {\r\n        Logger.debug(`no face detected. Skipping frame...`);\r\n      }\r\n    }\r\n    const drawOptions: DrawOptions = {\r\n      faceDrawBoxOptions: {\r\n        boxColor: Drawer.COLOR_GREEN\r\n      },\r\n      noseDrawBoxOptions: {\r\n        boxColor: Drawer.COLOR_YELLOW\r\n      }\r\n    };\r\n    return {\r\n      nextState: nextState,\r\n      drawOptions: drawOptions,\r\n      helpMessage: \"Move the tip of your nose inside the yellow area\",\r\n      helpAnimationNumber: 2\r\n    };\r\n  }\r\n\r\n  getMaximumDurationInSeconds(): number {\r\n    return parseInt(Utils.getConfig().STATE_NOSE_DURATION_IN_SECONDS);\r\n  }\r\n\r\n  getName(): string {\r\n    return NoseState.NAME;\r\n  }\r\n}\r\n\r\nexport class AreaState extends State {\r\n  static NAME = \"AreaState\";\r\n\r\n  private framesWithoutFace = 0;\r\n\r\n  process(\r\n    faces: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]\r\n  ): StateOutput {\r\n    let nextState: State = this;\r\n    let boxColor = Drawer.COLOR_RED;\r\n    if (faces.length === 1) {\r\n      if (this.isFaceBoxInsideFaceArea(faces[0].detection.box, false)) {\r\n        boxColor = Drawer.COLOR_GREEN;\r\n        nextState = new NoseState(this.challengeDetails);\r\n      }\r\n    } else {\r\n      if (\r\n        faces.length !== 0 ||\r\n        ++this.framesWithoutFace > parseInt(Utils.getConfig().STATE_AREA_MAX_FRAMES_WITHOUT_FACE)\r\n      ) {\r\n        Logger.info(`AreaState fail: #faces=${faces.length} framesWithoutFace=${this.framesWithoutFace}`);\r\n        nextState = new FailState(this.challengeDetails);\r\n      } else {\r\n        Logger.debug(`no face detected. Skipping frame...`);\r\n      }\r\n    }\r\n    const drawOptions: DrawOptions = {\r\n      faceDrawBoxOptions: {\r\n        boxColor: boxColor\r\n      }\r\n    };\r\n    return {\r\n      nextState: nextState,\r\n      drawOptions: drawOptions,\r\n      helpMessage: \"Center your face inside the area\",\r\n      helpAnimationNumber: 1\r\n    };\r\n  }\r\n\r\n  getMaximumDurationInSeconds(): number {\r\n    return parseInt(Utils.getConfig().STATE_AREA_DURATION_IN_SECONDS);\r\n  }\r\n\r\n  getName(): string {\r\n    return AreaState.NAME;\r\n  }\r\n}\r\n\r\nexport class FaceState extends State {\r\n  static NAME = \"FaceState\";\r\n\r\n  process(\r\n    faces: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]\r\n  ): StateOutput {\r\n    let nextState: State = this;\r\n    let helpMessage = undefined;\r\n    switch (faces.length) {\r\n      case 0:\r\n        helpMessage = \"No face detected. Look at the camera.\";\r\n        break;\r\n      case 1:\r\n        nextState = new AreaState(this.challengeDetails);\r\n        break;\r\n      default:\r\n        helpMessage = \"More than one face detected. Should be one.\";\r\n    }\r\n    const drawOptions: DrawOptions = {\r\n      faceDrawBoxOptions: {\r\n        boxColor: Drawer.COLOR_RED\r\n      }\r\n    };\r\n    return {\r\n      nextState: nextState,\r\n      drawOptions: drawOptions,\r\n      helpMessage: helpMessage\r\n    };\r\n  }\r\n\r\n  getName(): string {\r\n    return FaceState.NAME;\r\n  }\r\n}\r\n","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n// SPDX-License-Identifier: MIT-0\r\n\r\nimport * as faceapi from \"face-api.js\";\r\nimport Logger from \"js-logger\";\r\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\r\nimport { DrawOptions } from \"@/js/Drawer.ts\";\r\nimport { FaceState } from \"@/js/States.ts\";\r\nimport { FailState } from \"@/js/States.ts\";\r\nimport { NoseState } from \"@/js/States.ts\";\r\nimport { State } from \"@/js/States.ts\";\r\nimport { StateOutput } from \"@/js/States.ts\";\r\nimport { SuccessState } from \"@/js/States.ts\";\r\n\r\nexport interface StateManagerOutput {\r\n  readonly end: boolean;\r\n  readonly success?: boolean;\r\n  readonly shouldSaveFrame: boolean;\r\n  readonly drawOptions?: DrawOptions;\r\n  readonly helpMessage?: string;\r\n  readonly helpAnimationNumber?: number;\r\n}\r\n\r\nexport class StateManager {\r\n  private readonly challengeDetails: ChallengeDetails;\r\n\r\n  private currentState!: State;\r\n  private endTime!: number;\r\n\r\n  constructor(challengeDetails: ChallengeDetails) {\r\n    this.challengeDetails = challengeDetails;\r\n    this.changeCurrentState(new FaceState(this.challengeDetails));\r\n  }\r\n\r\n  process(\r\n    result: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]\r\n  ): StateManagerOutput {\r\n    Logger.debug(`current state: ${this.currentState.getName()}`);\r\n\r\n    if (this.endTime > 0 && Date.now() / 1000 > this.endTime) {\r\n      Logger.info(`fail: state timed out`);\r\n      this.changeCurrentState(new FailState(this.challengeDetails));\r\n    }\r\n    const stateOutput: StateOutput = this.currentState.process(result);\r\n    if (stateOutput.nextState) {\r\n      this.changeCurrentState(stateOutput.nextState);\r\n    }\r\n\r\n    let end = false;\r\n    let shouldSaveFrame = false;\r\n    let success;\r\n    if (this.currentState.getName() === SuccessState.NAME) {\r\n      end = true;\r\n      success = true;\r\n      shouldSaveFrame = true;\r\n    } else if (this.currentState.getName() === FailState.NAME) {\r\n      end = true;\r\n      success = false;\r\n    } else if (this.currentState.getName() === NoseState.NAME) {\r\n      shouldSaveFrame = true;\r\n    }\r\n    return {\r\n      end: end,\r\n      success: success,\r\n      shouldSaveFrame: shouldSaveFrame,\r\n      drawOptions: stateOutput.drawOptions,\r\n      helpMessage: stateOutput.helpMessage,\r\n      helpAnimationNumber: stateOutput.helpAnimationNumber\r\n    };\r\n  }\r\n\r\n  private changeCurrentState(state: State) {\r\n    if (this.currentState !== state) {\r\n      this.currentState = state;\r\n      this.endTime =\r\n        state.getMaximumDurationInSeconds() != -1 ? Date.now() / 1000 + state.getMaximumDurationInSeconds() : -1;\r\n    }\r\n  }\r\n}\r\n","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n// SPDX-License-Identifier: MIT-0\r\n\r\nimport * as faceapi from \"face-api.js\";\r\nimport Logger from \"js-logger\";\r\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\r\nimport { Drawer } from \"@/js/Drawer.ts\";\r\nimport { RemoteVerifier } from \"@/js/RemoteVerifier.ts\";\r\nimport { StateManager } from \"@/js/StateManager.ts\";\r\nimport { StateManagerOutput } from \"@/js/StateManager.ts\";\r\nimport { Utils } from \"@/js/Utils.ts\";\r\n\r\nexport class ChallengeProcessor {\r\n  private readonly endCallback: (success: boolean, remoteVerifier: RemoteVerifier | undefined) => void;\r\n  private readonly helpMessageCallback: (helpMessage: string | undefined) => void;\r\n  private readonly helpAnimatonCallback: (helpAnimationNumber: number | undefined) => void;\r\n  private readonly drawer: Drawer;\r\n  private readonly stateManager: StateManager;\r\n  private readonly videoElement: HTMLVideoElement;\r\n  private readonly canvasElement: HTMLCanvasElement;\r\n  private readonly remoteVerifier: RemoteVerifier;\r\n\r\n  private lastHelpMessage: string | undefined;\r\n  private lastHelpAnimationNumber: number | undefined;\r\n\r\n  constructor(\r\n    challengeDetails: ChallengeDetails,\r\n    videoElementId: string,\r\n    canvasElementId: string,\r\n    endCallback: (result: boolean) => void,\r\n    helpMessageCallback: (helpMessage: string | undefined) => void,\r\n    helpAnimatonCallback: (helpAnimationNumber: number | undefined) => void\r\n  ) {\r\n    this.endCallback = endCallback;\r\n    this.helpMessageCallback = helpMessageCallback;\r\n    this.helpAnimatonCallback = helpAnimatonCallback;\r\n    this.stateManager = new StateManager(challengeDetails);\r\n    this.videoElement = document.getElementById(videoElementId) as HTMLVideoElement;\r\n    if (!this.videoElement) {\r\n      throw \"Video element not found\";\r\n    }\r\n    this.remoteVerifier = new RemoteVerifier(challengeDetails.id, challengeDetails.token, this.videoElement);\r\n\r\n    this.canvasElement = document.getElementById(canvasElementId) as HTMLCanvasElement;\r\n    if (!this.canvasElement) {\r\n      throw \"Canvas element not found\";\r\n    }\r\n    this.drawer = new Drawer(challengeDetails, this.canvasElement);\r\n\r\n    this.videoElement.srcObject = Utils.getMediaStreamInfo().mediaStream;\r\n\r\n    const self = this;\r\n    self.videoElement.addEventListener(\"loadedmetadata\", function() {\r\n      ChallengeProcessor.process(self);\r\n    });\r\n  }\r\n\r\n  static loadModels() {\r\n    if (Utils.isProfiling()) {\r\n      Logger.time(\"faceDetectionModelLoad\");\r\n      Logger.time(\"faceLandmarkModelLoad\");\r\n    }\r\n    const promises: Promise<void>[] = [];\r\n    const url = \"/weights/\";\r\n    promises.push(this.loadFaceDetectionModel(url));\r\n    promises.push(this.loadLandmarkModel(url));\r\n    (window as any).modelPromises = promises;\r\n  }\r\n\r\n  private static loadFaceDetectionModel(url: string): Promise<void> {\r\n    const promise = faceapi.nets.tinyFaceDetector.load(url);\r\n    promise.then(function() {\r\n      if (Utils.isProfiling()) {\r\n        Logger.timeEnd(\"faceDetectionModelLoad\");\r\n      }\r\n      Logger.info(\"tinyFaceDetector model loaded\");\r\n    });\r\n    return promise;\r\n  }\r\n\r\n  private static loadLandmarkModel(url: string): Promise<void> {\r\n    const promise = faceapi.nets.faceLandmark68Net.load(url);\r\n    promise.then(function() {\r\n      if (Utils.isProfiling()) {\r\n        Logger.timeEnd(\"faceLandmarkModelLoad\");\r\n      }\r\n      Logger.info(\"faceLandmark68Net model loaded\");\r\n    });\r\n    return promise;\r\n  }\r\n\r\n  static process(challengeProcessor: ChallengeProcessor): any {\r\n    Logger.debug(\"video event handler\");\r\n    if (challengeProcessor.videoElement.paused || challengeProcessor.videoElement.ended) {\r\n      Logger.debug(\"video paused or ended\");\r\n      return setTimeout(() => ChallengeProcessor.process(challengeProcessor), 10);\r\n    }\r\n\r\n    if (Utils.isProfiling()) {\r\n      Logger.time(\"faceDetectionWithFaceLandmarks\");\r\n    }\r\n    const options = new faceapi.TinyFaceDetectorOptions();\r\n    faceapi\r\n      .detectAllFaces(challengeProcessor.videoElement, options)\r\n      .withFaceLandmarks(false)\r\n      .then(\r\n        // @ts-ignore\r\n        function(result: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]) {\r\n          if (Utils.isProfiling()) {\r\n            Logger.timeEnd(\"faceDetectionWithFaceLandmarks\");\r\n          }\r\n\r\n          if (result) {\r\n            ChallengeProcessor.processDetectionResults(challengeProcessor, result);\r\n          } else {\r\n            setTimeout(() => ChallengeProcessor.process(challengeProcessor));\r\n          }\r\n        }\r\n      );\r\n  }\r\n\r\n  static processDetectionResults(\r\n    challengeProcessor: ChallengeProcessor,\r\n    results: faceapi.WithFaceLandmarks<{ detection: faceapi.FaceDetection }, faceapi.FaceLandmarks68>[]\r\n  ) {\r\n    const dims = faceapi.matchDimensions(challengeProcessor.canvasElement, challengeProcessor.videoElement);\r\n    const resizedResults = faceapi.resizeResults(results, dims);\r\n    const stateManagerOutput: StateManagerOutput = challengeProcessor.stateManager.process(results);\r\n\r\n    if (Utils.getConfigBooleanValue(\"DRAW_DETECTIONS\")) {\r\n      faceapi.draw.drawDetections(challengeProcessor.canvasElement, resizedResults);\r\n      faceapi.draw.drawFaceLandmarks(challengeProcessor.canvasElement, resizedResults);\r\n    }\r\n\r\n    if (stateManagerOutput.drawOptions) {\r\n      challengeProcessor.drawer.draw(stateManagerOutput.drawOptions);\r\n    }\r\n\r\n    if (stateManagerOutput.helpMessage !== challengeProcessor.lastHelpMessage) {\r\n      Logger.debug(\r\n        `help message change: from='${challengeProcessor.lastHelpMessage}' to='${stateManagerOutput.helpMessage}'`\r\n      );\r\n      challengeProcessor.helpMessageCallback(stateManagerOutput.helpMessage);\r\n    }\r\n    challengeProcessor.lastHelpMessage = stateManagerOutput.helpMessage;\r\n\r\n    if (stateManagerOutput.helpAnimationNumber !== challengeProcessor.lastHelpAnimationNumber) {\r\n      Logger.debug(\r\n        `help animation change: from=${challengeProcessor.lastHelpAnimationNumber} to=${stateManagerOutput.helpAnimationNumber}`\r\n      );\r\n      challengeProcessor.helpAnimatonCallback(stateManagerOutput.helpAnimationNumber);\r\n    }\r\n    challengeProcessor.lastHelpAnimationNumber = stateManagerOutput.helpAnimationNumber;\r\n\r\n    if (stateManagerOutput.shouldSaveFrame) {\r\n      Logger.debug(\"should save frame\");\r\n      challengeProcessor.remoteVerifier.uploadFrame();\r\n    }\r\n\r\n    if (stateManagerOutput.end) {\r\n      const localSuccess = stateManagerOutput.success as boolean;\r\n      if (localSuccess) {\r\n        Logger.info(\"challenge successfully completed locally\");\r\n      } else {\r\n        Logger.info(\"challenge failed locally\");\r\n      }\r\n\r\n      // if successfully completed locally, pass along remoteVerifier to callback for remote verification\r\n      challengeProcessor.endCallback(localSuccess, localSuccess ? challengeProcessor.remoteVerifier : undefined);\r\n    } else {\r\n      const delay = 1000 / parseInt(Utils.getConfig().MAX_FPS);\r\n      setTimeout(() => ChallengeProcessor.process(challengeProcessor), delay);\r\n    }\r\n  }\r\n}\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Lottie from \"vue-lottie\";\r\nimport * as help1 from \"@/assets/lottie/help1.json\";\r\nimport * as help2 from \"@/assets/lottie/help2.json\";\r\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\r\nimport { ChallengeProcessor } from \"@/js/ChallengeProcessor.ts\";\r\nimport { RemoteVerifier } from \"@/js/RemoteVerifier.ts\";\r\nimport { Utils } from \"@/js/Utils.ts\";\r\n\r\nexport default Vue.extend({\r\n  name: \"Challenge\",\r\n  components: {\r\n    Lottie\r\n  },\r\n  props: {\r\n    details: Object\r\n  },\r\n  data() {\r\n    return {\r\n      message: \"Loading...\",\r\n      animation: -1,\r\n      // @ts-ignore\r\n      lottieOptions1: { animationData: help1.default },\r\n      // @ts-ignore\r\n      lottieOptions2: { animationData: help2.default },\r\n\r\n      videoWidth: Utils.getMediaStreamInfo().actualWidth,\r\n      videoHeight: Utils.getMediaStreamInfo().actualHeight,\r\n      shouldRotate: Utils.getConfigBooleanValue(\"FLIP_VIDEO\"),\r\n      // Ugly hack to pass variables to CSS\r\n      cssVars: {\r\n        \"--video-width\": Utils.getMediaStreamInfo().actualWidth + \"px\",\r\n        \"--video-height\": Utils.getMediaStreamInfo().actualHeight + \"px\",\r\n        \"--help-container-padding-top\": Utils.getMediaStreamInfo().actualHeight + 5 + \"px\"\r\n      }\r\n    };\r\n  },\r\n  methods: {\r\n    onLocalEnd(success: boolean, remoteVerifier: RemoteVerifier | undefined): void {\r\n      if (success) {\r\n        this.$emit(\"local-success\", remoteVerifier as RemoteVerifier);\r\n      } else {\r\n        this.$emit(\"local-fail\");\r\n      }\r\n    },\r\n    onHelpMessage(message: string | undefined): void {\r\n      this.message = message || \"\";\r\n    },\r\n    onHelpAnimation(animationNumber: number | undefined): void {\r\n      this.animation = animationNumber || -1;\r\n    }\r\n  },\r\n  mounted: function() {\r\n    const self: any = this;\r\n    this.$nextTick(function() {\r\n      new ChallengeProcessor(\r\n        self.details as ChallengeDetails,\r\n        \"webcamVideo\",\r\n        \"overlayCanvas\",\r\n        self.onLocalEnd,\r\n        self.onHelpMessage,\r\n        self.onHelpAnimation\r\n      );\r\n    });\r\n  }\r\n});\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Challenge.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Challenge.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Challenge.vue?vue&type=template&id=3d4ee5b2&scoped=true&\"\nimport script from \"./Challenge.vue?vue&type=script&lang=ts&\"\nexport * from \"./Challenge.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Challenge.vue?vue&type=style&index=0&id=3d4ee5b2&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3d4ee5b2\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"text-center mt-5\"},[_c('div',{staticClass:\"spinner-border big-spinner\",attrs:{\"role\":\"status\"}}),_c('h2',{staticClass:\"mt-5\"},[_vm._v(\"Processing...\")])])}]\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\n\r\nexport default Vue.extend({\r\n  name: \"Spinner\"\r\n});\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Spinner.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Spinner.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Spinner.vue?vue&type=template&id=4cdecada&scoped=true&\"\nimport script from \"./Spinner.vue?vue&type=script&lang=ts&\"\nexport * from \"./Spinner.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Spinner.vue?vue&type=style&index=0&id=4cdecada&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4cdecada\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"text-center\"},[_c('div',{attrs:{\"id\":\"vueRoot\"}},[_c('form',{ref:\"form\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.cpf),expression:\"cpf\"}],attrs:{\"placeholder\":\"Digite seu CPF.\"},domProps:{\"value\":_vm.cpf,\"value\":(_vm.cpf)},on:{\"input\":[function($event){if($event.target.composing){ return; }_vm.cpf=$event.target.value},_vm.persist]}})])]),_c('lottie',{attrs:{\"options\":_vm.lottieOptions,\"height\":300,\"width\":300}}),_vm._m(0),(_vm.loading)?_c('div',{staticClass:\"spinner-border mt-5\",attrs:{\"role\":\"status\"}}):_vm._e(),_c('button',{staticClass:\"btn btn-primary btn-lg mt-5\",attrs:{\"type\":\"button\",\"disabled\":!_vm.ready},on:{\"click\":function($event){_vm.start(), _vm.mounted()}}},[_vm._v(\" Verify now! \")])],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h4',{staticClass:\"display-4 mt-4\"},[_c('strong',[_vm._v(\"Liveness\")]),_vm._v(\" Detection\")])}]\n\nexport { render, staticRenderFns }","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n// SPDX-License-Identifier: MIT-0\r\n\r\nimport axios from \"axios\";\r\nimport Logger from \"js-logger\";\r\nimport { Utils } from \"@/js/Utils.ts\";\r\n\r\ninterface StartRequestData {\r\n  readonly userId: string;\r\n  readonly imageWidth: number;\r\n  readonly imageHeight: number;\r\n}\r\n\r\nexport interface ChallengeDetails {\r\n  readonly id: string;\r\n  readonly userId: string;\r\n  readonly token: string;\r\n  readonly areaHeight: number;\r\n  readonly areaLeft: number;\r\n  readonly areaTop: number;\r\n  readonly areaWidth: number;\r\n  readonly imageHeight: number;\r\n  readonly imageWidth: number;\r\n  readonly noseHeight: number;\r\n  readonly noseLeft: number;\r\n  readonly noseTop: number;\r\n  readonly noseWidth: number;\r\n}\r\n\r\nexport class RemoteStarter {\r\n  static startChallenge(\r\n    successCallback: (challengeDetails: ChallengeDetails) => void,\r\n    errorCallback: (error: Error) => void\r\n  ): void {\r\n    const url: string = Utils.getConfig().API_URL + Utils.getConfig().API_START_ENDPOINT;\r\n    const startRequestData: StartRequestData = {\r\n      userId: Utils.getUserId(),\r\n      imageWidth: Utils.getMediaStreamInfo().actualWidth,\r\n      imageHeight: Utils.getMediaStreamInfo().actualHeight\r\n    };\r\n    Logger.info(`calling ${url}`);\r\n    Logger.info(startRequestData);\r\n    axios\r\n      .post(url, startRequestData)\r\n      .then(function(response: any) {\r\n        Logger.info(response);\r\n        const challengeDetails: ChallengeDetails = response.data;\r\n        Logger.info(challengeDetails);\r\n        successCallback(challengeDetails);\r\n      })\r\n      .catch(function(error: any) {\r\n        Logger.error(error);\r\n        errorCallback(error);\r\n      });\r\n  }\r\n}\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Lottie from \"vue-lottie\";\r\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\r\nimport { RemoteStarter } from \"@/js/RemoteStarter.ts\";\r\nimport * as welcomeData from \"@/assets/lottie/welcome.json\";\r\nimport Logger from \"js-logger\"  \r\n\r\nexport default Vue.extend({\r\n  name: \"Welcome\",\r\n  components: {\r\n    Lottie\r\n  },\r\n  props: {\r\n    ready: Boolean\r\n  },\r\n  data() {\r\n    return {\r\n      cpf:'',\r\n      lottieOptions: {\r\n        // @ts-ignore\r\n        animationData: welcomeData.default,\r\n        loop: false\r\n      },\r\n      \r\n      loading: false\r\n    };\r\n  },\r\n  mounted() {\r\n      if (localStorage.cpf) {\r\n        this.cpf = localStorage.cpf\r\n  }},\r\n  methods: {\r\n    persist(){\r\n          const cpfliveness = localStorage.setItem('cpf', this.cpf)\r\n          Logger.info(`cpf=${this.cpf}`);\r\n          return cpfliveness\r\n\r\n    },\r\n    start(): void {\r\n      this.loading = true;\r\n      const self: any = this;\r\n      RemoteStarter.startChallenge(\r\n        function(challengeDetails: ChallengeDetails) {\r\n          // Make sure all models are loaded\r\n          Promise.all((window as any).modelPromises).then(function() {\r\n            self.$emit(\"challenge-details\", challengeDetails);\r\n          });\r\n        },\r\n        function(error: Error) {\r\n          self.$emit(\"error\", error);\r\n        }\r\n      );\r\n    },\r\n  }})\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Welcome.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Welcome.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Welcome.vue?vue&type=template&id=8841a0ce&scoped=true&\"\nimport script from \"./Welcome.vue?vue&type=script&lang=ts&\"\nexport * from \"./Welcome.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"8841a0ce\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"text-center\"},[_c('lottie',{attrs:{\"options\":_vm.lottieOptions,\"height\":200,\"width\":200}}),_c('h2',{staticClass:\"mt-4\"},[_vm._v(_vm._s(_vm.title))]),_c('h3',{staticClass:\"mt-2\"},[_c('small',{staticClass:\"text-muted\"},[_vm._v(_vm._s(_vm.message))])]),_c('button',{staticClass:\"btn btn-primary btn-lg mt-5\",attrs:{\"type\":\"button\"},on:{\"click\":function($event){return _vm.$emit('restart')}}},[_vm._v(_vm._s(_vm.buttonText))])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Lottie from \"vue-lottie\";\r\nimport * as successData from \"@/assets/lottie/success.json\";\r\nimport * as failData from \"@/assets/lottie/fail.json\";\r\n\r\nconst SUCCESS_TITLE = \"Verified!\";\r\nconst SUCCESS_MESSAGE = \"Successfully verified as a live person.\";\r\nconst SUCCESS_BUTTON = \"Start over\";\r\nconst FAIL_TITLE = \"Uh-oh.\";\r\nconst FAIL_MESSAGE = \"We could not detect a live person.\";\r\nconst FAIL_BUTTON = \"Try again\";\r\n\r\nexport default Vue.extend({\r\n  name: \"Result\",\r\n  components: {\r\n    Lottie\r\n  },\r\n  props: {\r\n    success: Boolean\r\n  },\r\n  computed: {\r\n    title(): string {\r\n      return this.success ? SUCCESS_TITLE : FAIL_TITLE;\r\n    },\r\n    message(): string {\r\n      return this.success ? SUCCESS_MESSAGE : FAIL_MESSAGE;\r\n    },\r\n    buttonText(): string {\r\n      return this.success ? SUCCESS_BUTTON : FAIL_BUTTON;\r\n    },\r\n    lottieOptions(): any {\r\n      return {\r\n        // @ts-ignore\r\n        animationData: this.success ? successData.default : failData.default,\r\n        loop: false\r\n      };\r\n    }\r\n  }\r\n});\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Result.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Result.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Result.vue?vue&type=template&id=b7e669d0&\"\nimport script from \"./Result.vue?vue&type=script&lang=ts&\"\nexport * from \"./Result.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"text-center\"},[_c('svg',{staticClass:\"bi bi-emoji-frown\",attrs:{\"width\":\"150px\",\"height\":\"150px\",\"viewBox\":\"0 0 16 16\",\"fill\":\"currentColor\",\"xmlns\":\"http://www.w3.org/2000/svg\"}},[_c('path',{attrs:{\"fill-rule\":\"evenodd\",\"d\":\"M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z\"}}),_c('path',{attrs:{\"fill-rule\":\"evenodd\",\"d\":\"M4.285 12.433a.5.5 0 0 0 .683-.183A3.498 3.498 0 0 1 8 10.5c1.295 0 2.426.703 3.032 1.75a.5.5 0 0 0 .866-.5A4.498 4.498 0 0 0 8 9.5a4.5 4.5 0 0 0-3.898 2.25.5.5 0 0 0 .183.683z\"}}),_c('path',{attrs:{\"d\":\"M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5zm4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5z\"}})]),_c('h2',{staticClass:\"mt-4\"},[_vm._v(\"Something went wrong\")]),_c('h3',{staticClass:\"mt-2\"},[_c('small',{staticClass:\"text-muted\"},[_vm._v(_vm._s(_vm.message))])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\n\r\nexport default Vue.extend({\r\n  name: \"Error\",\r\n  props: {\r\n    message: String\r\n  }\r\n});\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Error.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Error.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Error.vue?vue&type=template&id=3b94e560&\"\nimport script from \"./Error.vue?vue&type=script&lang=ts&\"\nexport * from \"./Error.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Challenge from \"./components/Challenge.vue\";\r\nimport Spinner from \"./components/Spinner.vue\";\r\nimport Welcome from \"./components/Welcome.vue\";\r\nimport Result from \"./components/Result.vue\";\r\nimport Error from \"./components/Error.vue\";\r\nimport { ChallengeDetails } from \"@/js/RemoteStarter.ts\";\r\nimport { ChallengeProcessor } from \"@/js/ChallengeProcessor.ts\";\r\nimport { RemoteVerifier } from \"@/js/RemoteVerifier.ts\";\r\nimport { Utils } from \"@/js/Utils.ts\";\r\n\r\nUtils.loadConfig();\r\nUtils.configureLogger();\r\n\r\nexport default Vue.extend({\r\n  name: \"App\",\r\n  components: {\r\n    Welcome,\r\n    Challenge,\r\n    Spinner,\r\n    Result,\r\n    Error\r\n  },\r\n  data() {\r\n    return {\r\n      challengeDetails: {},\r\n      success: false,\r\n      step: 1,\r\n      mediaStreamReady: false,\r\n      errorMessage: \"\"\r\n    };\r\n  },\r\n  methods: {\r\n    onChallengeDetails(challengeDetails: ChallengeDetails): void {\r\n      this.challengeDetails = challengeDetails;\r\n      this.step = 2;\r\n    },\r\n    onLocalSuccess(remoteVerifier: RemoteVerifier): void {\r\n      this.step = 3;\r\n\r\n      const self = this;\r\n      remoteVerifier.verify(\r\n        function(success: boolean) {\r\n          self.success = success;\r\n          self.step = 4;\r\n        },\r\n        function(error: Error) {\r\n          self.onError(error);\r\n        }\r\n      );\r\n    },\r\n    onLocalFail(): void {\r\n      this.success = false;\r\n      this.step = 4;\r\n    },\r\n    onRestart(): void {\r\n      this.step = 1;\r\n    },\r\n    onError(error: Error): void {\r\n      this.errorMessage = error.name + \": \" + error.message;\r\n      this.step = -1;\r\n    }\r\n  },\r\n  mounted: function() {\r\n    ChallengeProcessor.loadModels();\r\n\r\n    const self = this;\r\n    Utils.loadMediaStream(\r\n      function() {\r\n        self.mediaStreamReady = true;\r\n      },\r\n      function(message) {\r\n        self.errorMessage = message;\r\n        self.step = -1;\r\n      }\r\n    );\r\n  }\r\n});\r\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--14-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/ts-loader/index.js??ref--14-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--14-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/ts-loader/index.js??ref--14-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=af3b4878&\"\nimport script from \"./App.vue?vue&type=script&lang=ts&\"\nexport * from \"./App.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\r\n// SPDX-License-Identifier: MIT-0\r\n\r\nimport Vue from \"vue\";\r\nimport App from \"./App.vue\";\r\n\r\nVue.config.productionTip = false;\r\n\r\nnew Vue({\r\n  render: h => h(App)\r\n}).$mount(\"#app\");\r\n"],"sourceRoot":""}